<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>六、工程结构 | Java 编程规范</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Java 代码整洁之道">
    <link rel="preload" href="/assets/css/0.styles.f69a04f2.css" as="style"><link rel="preload" href="/assets/js/app.ebef3189.js" as="script"><link rel="preload" href="/assets/js/2.6bb482e9.js" as="script"><link rel="preload" href="/assets/js/4.42e5e5a2.js" as="script"><link rel="prefetch" href="/assets/js/10.43cf8674.js"><link rel="prefetch" href="/assets/js/11.e3e93c84.js"><link rel="prefetch" href="/assets/js/12.2916cd62.js"><link rel="prefetch" href="/assets/js/13.e0e9bcc6.js"><link rel="prefetch" href="/assets/js/14.134f0f23.js"><link rel="prefetch" href="/assets/js/15.ebf872e0.js"><link rel="prefetch" href="/assets/js/16.97604c24.js"><link rel="prefetch" href="/assets/js/17.f0da6ac9.js"><link rel="prefetch" href="/assets/js/18.683dd516.js"><link rel="prefetch" href="/assets/js/19.ac74fe53.js"><link rel="prefetch" href="/assets/js/20.16fbc1d6.js"><link rel="prefetch" href="/assets/js/21.1613b491.js"><link rel="prefetch" href="/assets/js/22.532d3087.js"><link rel="prefetch" href="/assets/js/3.b925be4d.js"><link rel="prefetch" href="/assets/js/5.00bc1fc7.js"><link rel="prefetch" href="/assets/js/6.8cf3236e.js"><link rel="prefetch" href="/assets/js/7.ee76a0f8.js"><link rel="prefetch" href="/assets/js/8.52beb9ac.js"><link rel="prefetch" href="/assets/js/9.d93f00cf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f69a04f2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Java 编程规范</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/alibaba/" class="nav-link router-link-active">
  阿里规范
</a></div><div class="nav-item"><a href="/google/" class="nav-link">
  谷歌规范
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/alibaba/project-struct-specification.html" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  English
</a></li></ul></div></div> <a href="https://github.com/programmingStyle/java.programming.style" target="_blank" rel="noopener noreferrer" class="repo-link">
    Java Programming Style
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/alibaba/" class="nav-link router-link-active">
  阿里规范
</a></div><div class="nav-item"><a href="/google/" class="nav-link">
  谷歌规范
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="选择语言" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/alibaba/project-struct-specification.html" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li><li class="dropdown-item"><!----> <a href="/en/" class="nav-link">
  English
</a></li></ul></div></div> <a href="https://github.com/programmingStyle/java.programming.style" target="_blank" rel="noopener noreferrer" class="repo-link">
    Java Programming Style
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java开发手册(泰山版)</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/alibaba/" class="sidebar-link">前言</a></li><li><a href="/alibaba/java-specification.html" class="sidebar-link">一、 编程规约</a></li><li><a href="/alibaba/exception-log-specification.html" class="sidebar-link">二、异常日志</a></li><li><a href="/alibaba/unit-test-specification.html" class="sidebar-link">三、单元测试</a></li><li><a href="/alibaba/security-specification.html" class="sidebar-link">四、安全规约</a></li><li><a href="/alibaba/mysql-database-specification.html" class="sidebar-link">五、MySQL 数据库</a></li><li><a href="/alibaba/project-struct-specification.html" class="active sidebar-link">六、工程结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/alibaba/project-struct-specification.html#一-应用分层" class="sidebar-link">(一) 应用分层</a></li><li class="sidebar-sub-header"><a href="/alibaba/project-struct-specification.html#二-二方库依赖" class="sidebar-link">(二) 二方库依赖</a></li><li class="sidebar-sub-header"><a href="/alibaba/project-struct-specification.html#三-服务器" class="sidebar-link">(三) 服务器</a></li></ul></li><li><a href="/alibaba/design-specification.html" class="sidebar-link">七、设计规约</a></li><li><a href="/alibaba/appendix.html" class="sidebar-link">附录</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="六、工程结构"><a href="#六、工程结构" class="header-anchor">#</a> 六、工程结构</h1> <h2 id="一-应用分层"><a href="#一-应用分层" class="header-anchor">#</a> (一) 应用分层</h2> <ol><li><p>【推荐】图中默认上层依赖于下层，箭头关系表示可直接依赖，如：开放接口层可以依赖于 Web 层，也可以直接依赖于Service层，依此类推：
<img src="/assets/img/application-dependency.6d6bc37c.png" alt="An image"></p> <ul><li><p>开放接口层：可直接封装Service方法暴露成RPC接口；通过Web封装成http接口；网关控制层等。</p></li> <li><p>终端显示层：各个端的模板渲染并执行显示的层。当前主要是velocity渲染，JS渲染，JSP渲染，移动端展示等。</p></li> <li><p>Web层：主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。</p></li> <li><p>Service层：相对具体的业务逻辑服务层。</p></li> <li><p>Manager层：通用业务处理层，它有如下特征：</p> <p>1 ） 对第三方平台封装的层，预处理返回结果及转化异常信息。</p> <p>2 ） 对Service层通用能力的下沉，如缓存方案、中间件通用处理。</p> <p>3 ） 与DAO层交互，对多个DAO的组合复用。</p></li> <li><p>DAO层：数据访问层，与底层 MySQL、Oracle、Hbase、OB 等进行数据交互。</p></li> <li><p>外部接口或第三方平台：包括其它部门 RPC 开放接口，基础平台，其它公司的 HTTP 接口。</p></li></ul></li> <li><p>【参考】（分层异常处理规约）在DAO层，产生的异常类型有很多，无法用细粒度的异常进行 catch，使用<code>catch(Exception e)</code>方式，并<code>throw new DAOException(e)</code>，不需要打印日志，因为日志在<code>Manager/Service</code>层一定需要捕获并打印到日志文件中去，如果同台服务器再打日志，浪费性能和存储。在Service层出现异常时，必须记录出错日志到磁盘，尽可能带上参数信息，相当于保护案发现场。Manager层与Service同机部署，日志方式与DAO层处理一致，如果是单独部署，则采用与Service一致的处理方式。Web层绝不应该继续往上抛异常，因为已经处于顶层，如果意识到这个异常将导致页面无法正常渲染，那么就应该直接跳转到友好错误页面，尽量加上友好的错误提示信息。开放接口层要将异常处理成错误码和错误信息方式返回。</p></li> <li><p>【参考】分层领域模型规约：</p> <ul><li><code>DO（Data Object）</code>：此对象与数据库表结构一一对应，通过<code>DAO</code>层向上传输数据源对象。</li> <li><code>DTO（Data Transfer Object）</code>：数据传输对象，Service或Manager向外传输的对象。</li> <li><code>BO（Business Object）</code>：业务对象，可以由Service层输出的封装业务逻辑的对象。</li> <li><code>Query</code>：数据查询对象，各层接收上层的查询请求。注意超过 <code>2</code> 个参数的查询封装，<strong>禁止</strong>使用 <code>Map</code> 类来传输。</li> <li><code>VO（View Object）</code>：显示层对象，通常是Web向模板渲染引擎层传输的对象。</li></ul></li></ol> <h2 id="二-二方库依赖"><a href="#二-二方库依赖" class="header-anchor">#</a> (二) 二方库依赖</h2> <ol><li><p>【强制】定义GAV遵从以下规则：
1 ） <strong>GroupID格式</strong>：<code>com.{公司/BU }.业务线[.子业务线]</code>，最多 <code>4</code> 级。</p> <div class="custom-block warning"><p class="custom-block-title">说明：</p> <p><code>{公司/BU}</code> 例如：alibaba/taobao/tmall/aliexpress等BU一级；子业务线可选。</p></div> <div class="custom-block tip"><p class="custom-block-title">正例：</p> <p><code>com.taobao.jstorm</code> 或 <code>com.alibaba.dubbo.register</code></p></div> <p>2 ） <strong>ArtifactID格式</strong>：<code>产品线名-模块名</code>。语义不重复不遗漏，先到中央仓库去查证一下。</p> <div class="custom-block tip"><p class="custom-block-title">正例：</p> <p><code>dubbo-client</code> / <code>fastjson-api</code> / <code>jstorm-tool</code></p></div> <p>3 ） <strong>Version</strong>：详细规定参考下方。</p></li> <li><p>【强制】<strong>二方库版本号命名方式</strong>：<code>主版本号.次版本号.修订号</code></p> <p>1 ）<strong>主版本号</strong>：产品方向改变，或者大规模API不兼容，或者架构不兼容升级。</p> <p>2 ）<strong>次版本号</strong>：保持相对兼容性，增加主要功能特性，影响范围极小的API不兼容修改。</p> <p>3 ）<strong>修订号</strong>：保持完全兼容性，修复BUG、新增次要功能特性等。</p> <div class="custom-block warning"><p class="custom-block-title">说明：</p> <p>注意起始版本号必须为：1.0.0，而不是0.0.1。</p></div> <div class="custom-block danger"><p class="custom-block-title">反例：</p> <p>仓库内某二方库版本号从1.0.0.0开始，一直默默“升级”成1.0.0.64，完全失去版本的语义信息。</p></div></li> <li><p>【强制】线上应用不要依赖 <code>SNAPSHOT</code> 版本（安全包除外）；正式发布的类库必须先去中央仓库进行查证，使 <code>RELEASE</code> 版本号有延续性，且版本号不允许覆盖升级。</p> <div class="custom-block warning"><p class="custom-block-title">说明：</p> <p>不依赖 <code>SNAPSHOT</code> 版本是保证应用发布的幂等性。另外，也可以加快编译时的打包构建。</p></div></li> <li><p>【强制】二方库的新增或升级，保持除功能点之外的其它 <code>jar</code> 包仲裁结果不变。如果有改变，必须明确评估和验证。</p> <div class="custom-block warning"><p class="custom-block-title">说明：</p> <p>在升级时，进行 <code>dependency:resolve</code> 前后信息比对，如果仲裁结果完全不一致，那么通过 <code>dependency:tree</code>命令，找出差异点，进行<code>&lt;exclude&gt;</code>排除jar包。</p></div></li> <li><p>【强制】二方库里可以定义枚举类型，参数可以使用枚举类型，但是接口返回值不允许使用枚举类型或者包含枚举类型的POJO对象。</p></li> <li><p>【强制】依赖于一个二方库群时，必须定义一个统一的版本变量，避免版本号不一致。</p> <div class="custom-block warning"><p class="custom-block-title">说明：</p> <p>依赖<code>springframework-core</code>,<code>-context</code>,<code>-beans</code>，它们都是同一个版本，可以定义一个变量来保存版本：<code>${spring.version}</code>，定义依赖的时候，引用该版本。</p></div></li> <li><p>【强制】禁止在子项目的<code>pom依赖</code>中出现<strong>相同</strong>的<code>GroupId</code>，<strong>相同</strong>的<code>ArtifactId</code>，但是<strong>不同</strong>的<code>Version</code>。</p> <div class="custom-block warning"><p class="custom-block-title">说明：</p> <p>在本地调试时会使用各子项目指定的版本号，但是合并成一个war，只能有一个版本号出现在最后的lib目录中。曾经出现过线下调试是正确的，发布到线上却出故障的先例。</p></div></li> <li><p>【推荐】底层基础技术框架、核心数据管理平台、或近硬件端系统谨慎引入第三方实现。</p></li> <li><p>【推荐】所有pom文件中的依赖声明放在<code>&lt;dependencies&gt;</code>语句块中，所有版本仲裁放在 <code>&lt;dependencyManagement&gt;</code>语句块中。</p> <div class="custom-block warning"><p class="custom-block-title">说明：</p> <p><code>&lt;dependencyManagement&gt;</code>里只是声明版本，并不实现引入，因此子项目需要显式的声明依赖，version和scope都读取自父pom。而<code>&lt;dependencies&gt;</code>所有声明在主pom的<code>&lt;dependencies&gt;</code>里的依赖都会自动引入，并默认被所有的子项目继承。</p></div></li> <li><p>【推荐】二方库不要有配置项，最低限度不要再增加配置项。</p></li> <li><p>【推荐】不要使用不稳定的工具包或者Utils类。</p> <div class="custom-block warning"><p class="custom-block-title">说明：</p> <p>不稳定指的是提供方无法做到向下兼容，在编译阶段正常，但在运行时产生异常，因此，尽量使用业界稳定的二方工具包。</p></div></li> <li><p>【参考】为避免应用二方库的依赖冲突问题，二方库发布者应当遵循以下原则：
1 ） <strong>精简可控原则</strong> 。移除一切不必要的API和依赖，只包含 Service API、必要的领域模型对象、Utils类、常量、枚举等。如果依赖其它二方库，尽量是provided引入，让二方库使用者去依赖具体版本号；无log具体实现，只依赖日志框架。
2 ） <strong>稳定可追溯原则</strong> 。每个版本的变化应该被记录，二方库由谁维护，源码在哪里，都需要能方便查到。除非用户主动升级版本，否则公共二方库的行为不应该发生变化。</p></li></ol> <h2 id="三-服务器"><a href="#三-服务器" class="header-anchor">#</a> (三) 服务器</h2> <ol><li>【推荐】高并发服务器建议调小TCP协议的time_wait超时时间。<div class="custom-block warning"><p class="custom-block-title">说明：</p> <p>操作系统默认 240 秒后，才会关闭处于time_wait状态的连接，在高并发访问下，服务器端会因为处于time_wait的连接数太多，可能无法建立新的连接，所以需要在服务器上调小此等待值。</p></div> <div class="custom-block tip"><p class="custom-block-title">正例：</p> <p>在linux服务器上请通过变更/etc/sysctl.conf文件去修改该缺省值（秒）：</p> <p><code>net.ipv4.tcp_fin_timeout = 30</code></p></div></li> <li>【推荐】调大服务器所支持的最大文件句柄数（File Descriptor，简写为fd）。<div class="custom-block warning"><p class="custom-block-title">说明：</p> <p>主流操作系统的设计是将<code>TCP/UDP</code>连接采用与文件一样的方式去管理，即一个连接对应于一个fd。主流的linux服务器默认所支持最大fd数量为 <code>1024</code> ，当并发连接数很大时很容易因为fd不足而出现“open too many files”错误，导致新的连接无法建立。建议将linux服务器所支持的最大句柄数调高数倍（与服务器的内存数量相关）。</p></div></li> <li>【推荐】给<code>JVM</code>环境参数设置<code>-XX:+HeapDumpOnOutOfMemoryError</code>参数，让<code>JVM</code>碰到<code>OOM</code>场景时输出<code>dump</code>信息。<div class="custom-block warning"><p class="custom-block-title">说明：</p> <p>OOM的发生是有概率的，甚至相隔数月才出现一例，出错时的堆内信息对解决问题非常有帮助。</p></div></li> <li>【推荐】在线上生产环境，JVM的<code>Xms</code>和<code>Xmx</code>设置一样大小的内存容量，避免在GC 后调整堆大小带来的压力。</li> <li>【参考】<strong>服务器内部重定向</strong>必须使用<code>forward</code>；<strong>外部重定向</strong>地址必须使用<code>URL Broker</code>生成，否则因线上采用<code>HTTPS</code>协议而导致浏览器提示“不安全“。此外，还会带来URL维护不一致的问题。</li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/programmingStyle/java.programming.style/edit/master/alibaba/project-struct-specification.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020-4-29 09:11:06</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/alibaba/mysql-database-specification.html" class="prev">
        五、MySQL 数据库
      </a></span> <span class="next"><a href="/alibaba/design-specification.html">
        七、设计规约
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ebef3189.js" defer></script><script src="/assets/js/2.6bb482e9.js" defer></script><script src="/assets/js/4.42e5e5a2.js" defer></script>
  </body>
</html>
